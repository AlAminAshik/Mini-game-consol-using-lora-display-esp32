#include <SPI.h>                // Include the SPI library for SPI communication
#include <Wire.h>               // Include the Wire library for I2C communication
#include <Adafruit_GFX.h>       // Include the Adafruit GFX library for graphics
#include <Adafruit_SSD1306.h>   // Include the Adafruit SSD1306 library for OLED display
#include "esp32-hal-ledc.h"

//setup the display
#define i2c_Address 0x3c //initialize with the I2C addr 0x3C Typically eBay OLED's
#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels
// Declaration for an SSD1306 display connected to I2C (SDA, SCL pins)
#define OLED_RESET     -1  // Reset pin # (or -1 if sharing Arduino reset pin)
//TwoWire twi = TwoWire(1); // create our own TwoWire instance for I2C communication
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

//for hamba game
int cow_position = 0; // Variable to hold the cow's position
#define LOGO_HEIGHT   64
#define LOGO_WIDTH    128
// 'cow stroke image-01-01', 128x64px
const unsigned char cowOutline [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x74, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xec, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x3c, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x38, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x60, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x08, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x80, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x08, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xc0, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x02, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x03, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x03, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x07, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x05, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x05, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x09, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x0a, 0x20, 0x06, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x12, 0x20, 0x19, 0x80, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x16, 0x40, 0x30, 0x60, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x1c, 0x40, 0x40, 0x1c, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x18, 0x40, 0x80, 0x03, 0xf8, 0x7f, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x41, 0x00, 0x00, 0x0f, 0x81, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x42, 0x00, 0x00, 0x00, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x01, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0xc4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
// 'cow filled image-02-02', 128x64px
const unsigned char cowFilled [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xec, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1f, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xfc, 0x00, 0x07, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x80, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x01, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x01, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x03, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x03, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x07, 0x1f, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x07, 0x1f, 0xf8, 0x3f, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x06, 0x1f, 0xe0, 0x0f, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x04, 0x1f, 0xc0, 0x01, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1f, 0x80, 0x00, 0x07, 0xc0, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


//for number guess game
int targetNumber = 0; 
int currentNumber = 1;

//button pin defined
#define playButton 25
volatile bool buttonPressed = false;
volatile unsigned long pressStartTime = 0;
volatile bool buttonHeld = false;

//other pins defined
#define RedLights 17
#define GreenLights 13 //pin 21 consumes too much power!
#define Buzzer_pin 5 // Buzzer pin  

bool runHamba = false; // Flag to indicate if the game is running
bool runNumberHold = false; // Flag to indicate if the game is running
bool endGame = true; // Flag to indicate if the game is over

unsigned long previousMillis = 0; //for flashing leds
bool ledState = LOW; // Variable to hold the state of the LED

// Menu variables
int currentMenu = 0;   // 0 = first game, 1 = second game
const int menuCount = 2;

void drawMenu() {
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);

  // Menu item 1
  display.setCursor(20, 20);
  display.print("Play Hamba Game");
  // Menu item 2
  display.setCursor(20, 40);
  display.print("Play Number Hold");

  // Draw arrow
  if (currentMenu == 0) {
    display.setCursor(5, 20);
    display.print(">");
  } else {
    display.setCursor(5, 40);
    display.print(">");
  }

  display.display();
}

void menuAction(int menuIndex) {
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);

  if (menuIndex == 0) {
    display.setCursor(0, 20);
    runHamba = true;  // Set flag to run Hamba game
    Serial.println("Function 1 executed");
  } else if (menuIndex == 1) {
    display.setCursor(0, 20);
    targetNumber = random(1, 11); // Set a initial random target number between 1 and 10
    runNumberHold = true;  // Set flag to run Number Hold game
    Serial.println("Function 2 executed");
  }
  display.display();
}

void testdrawrect(void) {
  display.clearDisplay();

  for(int16_t i=0; i<display.height()/2; i+=2) {
    display.drawRect(i, i, display.width()-2*i, display.height()-2*i, SSD1306_WHITE);
    display.display(); // Update screen with each newly-drawn rectangle
    delay(1);
  }

  delay(500);
}

void testfillrect(void) {

  for(int16_t i=0; i<display.height()/2; i+=3) {
    // The INVERSE color is used so rectangles alternate white/black
    display.fillRect(i, i, display.width()-i*2, display.height()-i*2, SSD1306_INVERSE);
    display.display(); // Update screen with each newly-drawn rectangle
    delay(1);
  }

  delay(1000);
}

void testfillcircle(void) {
  display.clearDisplay();

  for(int16_t i=0; i<max(display.width(),display.height())/2; i+=3) {
    // The INVERSE color is used so circles alternate white/black
    display.fillCircle(display.width() / 2, display.height() / 2, i, SSD1306_INVERSE);
    display.display(); // Update screen with each newly-drawn circle
    delay(1);
  }

  delay(100);
}

//Starting Sound
void playStartSound() {
  ledcWriteTone(Buzzer_pin, 1000);
  delay(200);
  ledcWriteTone(Buzzer_pin, 1500);
  delay(200);
  ledcWriteTone(Buzzer_pin, 2000);
  delay(200);
  ledcWriteTone(Buzzer_pin, 0);
}

// Winning Sound
void playWinSound() {
  ledcWriteTone(Buzzer_pin, 1500);
  delay(200);
  ledcWriteTone(Buzzer_pin, 1800);
  delay(250);
  ledcWriteTone(Buzzer_pin, 2200);
  delay(350);
  ledcWriteTone(Buzzer_pin, 0);
}

//Losing Sound
void playLoseSound() {
  ledcWriteTone(Buzzer_pin, 1000);
  delay(350);
  ledcWriteTone(Buzzer_pin, 600);
  delay(350);
  ledcWriteTone(Buzzer_pin, 0);
  ledcWriteTone(Buzzer_pin, 400);
  delay(500);
  ledcWriteTone(Buzzer_pin, 0);
}

//celebration function
void celebration(){
  testdrawrect();      // Draw rectangles (outlines)
  testfillrect();      // Draw rectangles (filled)
  testfillcircle();    // Draw circles (filled)

  display.clearDisplay();           // clear the display
  display.setTextSize(2);          // set text size to 2
  display.setTextColor(SSD1306_WHITE); // set text color to white
  display.setCursor(30,10);          // set cursor to top left corner
  display.print("You're ");     // printa "Received: " on the display
  display.setCursor(15,30);         // set cursor to second line
  display.print("a Winner!");     // print the received data on the display
  display.display();               // update the display
  
  // Invert and restore display, pausing in-between
  display.invertDisplay(true);
  delay(500);
  display.invertDisplay(false);
  delay(500);
  // Invert and restore display, pausing in-between
  display.invertDisplay(true);
  delay(500);
  display.invertDisplay(false);
  delay(500);
}

ICACHE_RAM_ATTR void Play_button_pressed() {
  Serial.println("Play button pressed!");
  if (digitalRead(playButton) == LOW) {
    pressStartTime = millis();
    buttonHeld = false;
    buttonPressed = true;
  }
}


void setup() {

  Serial.begin(115200); // Initialize serial communication for debugging
  Wire.begin(4, 15); // Needs to come before display.begin() is used

  pinMode(playButton, INPUT_PULLUP); // Set play button pin as input with pull-up resistor
  attachInterrupt(digitalPinToInterrupt(playButton), Play_button_pressed, FALLING); // Attach interrupt to play button for falling edge
  
  pinMode(RedLights, OUTPUT); // Set RedLights pin as output
  pinMode(GreenLights, OUTPUT); // Set GreenLights pin as output
  ledcAttachChannel(Buzzer_pin, 5000, 8, 0);  // ledcAttachChannel(pin, frequency, resolution, channel)
  ledcWriteTone(Buzzer_pin, 0); // Initialize buzzer to off

  //On Heltec boards, the OLED is built-in and powered via GPIO 16 and a FET. 
  //It must be pulled HIGH before the OLED is usable.
  pinMode(16, OUTPUT);       // Power control for OLED
  digitalWrite(16, HIGH);    // Turn on the mosfet connected to OLED
  delay(100);                // Allow time for OLED to power up
  // SSD1306_SWITCHCAPVCC = generate display voltage from 3.3V internally
  if(!display.begin(SSD1306_SWITCHCAPVCC, i2c_Address)) {
  Serial.println(F("SSD1306 allocation failed"));
  for(;;); // Don't proceed, loop forever
  }
  Serial.println("Display Initialized OK!");
  
  display.clearDisplay();           // clear the display
  display.setTextSize(2);          // set text size to 2
  display.setTextColor(SSD1306_WHITE); // set text color to white
  display.setCursor(14,0);          // set cursor to top left corner
  display.print("Hamba");         // print "Hamba" on the display
  display.setCursor(14,20);         // set cursor to next line
  display.print("Game!!");           // print "Game!!" on the display
  display.display();               // update the display
  // Draw loading bar border
  display.drawRect(14, 40, 100, 10, SSD1306_WHITE);
  display.display();
  // Animate loading bar
  for (int i = 0; i <= 100; i += 5) {
    int barWidth = i;
    display.fillRect(15, 41, barWidth, 8, SSD1306_WHITE);
    // Percentage text
    display.setCursor(54, 55);
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE, SSD1306_BLACK); // overwrite old text
    display.print(i);
    display.print("%");
    display.display();
    delay(100);
  }

  playStartSound(); // Play the starting sound
  Serial.println("console started!");
}


void play_hamba_game(){
//run filled cow image
for (cow_position = -100; cow_position < 100; cow_position=cow_position+5) {
    display.clearDisplay();           // clear the display
    display.setCursor(0,0);          // set cursor to top left corner
    display.drawBitmap(cow_position, 0, cowFilled, LOGO_WIDTH, LOGO_HEIGHT, SSD1306_WHITE);
    //hold outline of the cow
    display.drawBitmap(0, 0, cowOutline, LOGO_WIDTH, LOGO_HEIGHT, SSD1306_WHITE);
    display.display();            // update the display
    delay(8);                      // wait for 10 milliseconds
    
    //loop until button is pressed
    if(buttonPressed == true) { //stop when button is pressed
      break;
    }
    
    //flash the red and blue lights
    unsigned long currentMillis = millis(); // Get the current time
    if(currentMillis - previousMillis >= 500) { // If 500 milliseconds have passed
      previousMillis = currentMillis; // Store the current time
      ledState = !ledState; // Change the state of the LED
      digitalWrite(RedLights, ledState); // Turn on RedLights
      digitalWrite(GreenLights, !ledState); // Turn off GreenLights
      //play buzzer sound
      ledcWriteTone(Buzzer_pin, 1000);
    }
    else {
      ledcWriteTone(Buzzer_pin, 0); // Turn off buzzer sound
    }
}

if(buttonPressed){
    delay(200); //wait to show the last cow position frame
    // If the game is not running, turn off the lights
    digitalWrite(RedLights, LOW); // Turn on RedLights
    digitalWrite(GreenLights, LOW); // Turn on GreenLights

    if(cow_position >= -10 && cow_position <= -6) {
      playWinSound(); // Play the winning sound
      celebration(); // Call the celebration function to show the celebration graphics
    
      //wait until the play button is pressed to play again
      while (digitalRead(playButton) == HIGH) {
        // Wait for the play button to be pressed
        digitalWrite(RedLights, HIGH); // Turn off RedLights
        digitalWrite(GreenLights, HIGH); // Turn off GreenLights
        display.clearDisplay(); // Clear the display
        display.setCursor(14, 15); // Set cursor to top left corner
        display.setTextSize(2); // Set text size to 2
        display.setTextColor(SSD1306_WHITE); // Set text color to white
        display.print("Play"); // Print "Play" on the display
        display.setCursor(14, 35); // Set cursor to next line
        display.print("Again!!"); // Print "Again!!" on the display
        display.display(); // Update the display
        ledcWriteTone(Buzzer_pin, 0); // Play no  sound while waiting
      }
      buttonPressed = false; //reset button pressed flag
    } 
    else {
      playLoseSound(); // Play the losing sound
      while (digitalRead(playButton) == HIGH) {
        //display win or loose
        display.clearDisplay(); // Clear the display
        display.setCursor(10, 20); // Set cursor to top left corner
        display.setTextSize(2); // Set text size to 2
        display.setTextColor(SSD1306_WHITE); // Set text color to white
        display.print("You Lose!"); // Print "You Lose!" on the display
        display.setCursor(12, 40); // Set cursor to top left corner
        display.setTextSize(1); // Set text size to 1
        display.setTextColor(SSD1306_WHITE); // Set text color to white
        display.print("Try Again!"); // Print "Try Again!" on the display
        display.display(); // Update the display
        }
        buttonPressed = false; //reset button pressed flag
      }
    }
}



void play_number_hold_game(){
  // while(buttonPressed == false) { //loop until button is pressed
    currentNumber = (currentNumber % 10) + 1;

    display.clearDisplay(); 
    //Target number at top 
    display.setTextSize(2); 
    display.setTextColor(SSD1306_WHITE); 
    display.setCursor(16, 0); 
    display.print("Target:"); 
    display.setCursor(100, 0); 
    display.print(targetNumber); 
    // Circulating number at bottom 
    display.setTextSize(4); 
    display.setCursor(50, 30); 
    display.print(currentNumber); 
    display.display();
    delay(150); // Small delay to allow display to update

      //flash the red and blue lights
    unsigned long currentMillis = millis(); // Get the current time
    if(currentMillis - previousMillis >= 500) { // If 500 milliseconds have passed
      previousMillis = currentMillis; // Store the current time
      ledState = !ledState; // Change the state of the LED
      digitalWrite(RedLights, ledState); // Turn on RedLights
      digitalWrite(GreenLights, !ledState); // Turn off GreenLights
      //play buzzer sound
      ledcWriteTone(Buzzer_pin, 1000);
    }
    else {
      ledcWriteTone(Buzzer_pin, 0); // Turn off buzzer sound
    }
  // }

  //check for win or lose condition
  if(buttonPressed){
    delay(200); //wait to show the last cow position frame
    // If the game is not running, turn off the lights
    digitalWrite(RedLights, LOW); // Turn on RedLights
    digitalWrite(GreenLights, LOW); // Turn on GreenLights

    if(currentNumber == targetNumber) {
      playWinSound(); // Play the winning sound
      celebration(); // Call the celebration function to show the celebration graphics
    
      //wait until the play button is pressed to play again
      while (digitalRead(playButton) == HIGH) {
        // Wait for the play button to be pressed
        digitalWrite(RedLights, HIGH); // Turn off RedLights
        digitalWrite(GreenLights, HIGH); // Turn off GreenLights
        display.clearDisplay(); // Clear the display
        display.setCursor(14, 15); // Set cursor to top left corner
        display.setTextSize(2); // Set text size to 2
        display.setTextColor(SSD1306_WHITE); // Set text color to white
        display.print("Play"); // Print "Play" on the display
        display.setCursor(14, 35); // Set cursor to next line
        display.print("Again!!"); // Print "Again!!" on the display
        display.display(); // Update the display
        ledcWriteTone(Buzzer_pin, 0); // Play no  sound while waiting
      }
      buttonPressed = false; //reset button pressed flag
    } 
    else {
      playLoseSound(); // Play the losing sound
      while (digitalRead(playButton) == HIGH) {
        //display win or loose
        display.clearDisplay(); // Clear the display
        display.setCursor(10, 20); // Set cursor to top left corner
        display.setTextSize(2); // Set text size to 2
        display.setTextColor(SSD1306_WHITE); // Set text color to white
        display.print("You Lose!"); // Print "You Lose!" on the display
        display.setCursor(12, 40); // Set cursor to top left corner
        display.setTextSize(1); // Set text size to 1
        display.setTextColor(SSD1306_WHITE); // Set text color to white
        display.print("Try Again!"); // Print "Try Again!" on the display
        display.display(); // Update the display
        }
        buttonPressed = false; //reset button pressed flag
      }
    targetNumber = random(1, 11); // reset random 1â€“10
    currentNumber = 0;  //reset current number to 0
    }
}



void loop() {
   if (endGame) drawMenu(); //show menu when no gameq is running
   else if (runHamba == true && !endGame) play_hamba_game(); // Call the play_hamba_game function to run the game
   else if (runNumberHold == true && !endGame) play_number_hold_game(); // Call the play_number_hold_game function to run the game

    //exit from any game if button is held for more than 2 seconds
    if (digitalRead(playButton) == LOW){
      if(millis() - pressStartTime > 2000) {
        if(digitalRead(playButton) == LOW) {
          digitalWrite(RedLights, LOW); // Turn off RedLights
          digitalWrite(GreenLights, LOW); // Turn off GreenLights
          ledcWriteTone(Buzzer_pin, 0); // Turn off buzzer sound
          runHamba = false;
          runNumberHold = false;
          endGame = true;   // Set flag to indicate game is over
        }
      }
    }

    //show menu until a game is selected
    if (buttonPressed) {
      buttonPressed = false;
      // Debounce check
      delay(50);
      if (digitalRead(playButton) == LOW) {
        unsigned long pressDuration = 0;

        // Wait until button released
        while (digitalRead(playButton) == LOW) {
          pressDuration = millis() - pressStartTime;
          if (pressDuration > 1000 && !buttonHeld) {  // long press
              buttonHeld = true;
              endGame = false; // Exit menu mode
              menuAction(currentMenu);
              break;
          }
        }
        // If short press (less than 1s)
        if (!buttonHeld) {
          currentMenu = (currentMenu + 1) % menuCount; // Move to next menu item
          drawMenu();
        }
      }
    }
}